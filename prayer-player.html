<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Stream Countdown</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
      color: white;
      font-family: Arial, sans-serif;
    }
    #countdown {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-size: 2.5em;
    }
    #stream {
      width: 100vw;
      height: 100vh;
      object-fit: contain;
      background: black;
      display: none;
    }
    #fullscreenBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      background: rgba(0,0,0,0.6);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 18px;
      font-size: 16px;
      cursor: pointer;
      display: none;
    }
    .hide-native-fullscreen video::-webkit-media-controls-fullscreen-button {
      display: none;
    }
    .hide-native-fullscreen video::-webkit-media-controls-enclosure {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="countdown">
    <div>Live Stream begins in:</div>
    <div id="timer"></div>
  </div>
  <video id="stream" controls playsinline autoplay></video>
  <button id="fullscreenBtn">Fullscreen</button>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // Set the stream times (in local time)
    function getNextSundayTime(hour, minute) {
      const now = new Date();
      const result = new Date(now);
      result.setHours(hour, minute, 0, 0);
      // 0 = Sunday, 6 = Saturday
      let daysUntilSunday = (7 - now.getDay()) % 7;
      if (daysUntilSunday === 0 && now > result) {
        daysUntilSunday = 7;
      }
      result.setDate(now.getDate() + daysUntilSunday);
      return result;
    }
    const streamStartTime = getNextSundayTime(11, 30); // 11:30am Sunday
    const revealTime = getNextSundayTime(11, 15); // 11:15am Sunday

    const countdownDiv = document.getElementById('countdown');
    const timerDiv = document.getElementById('timer');
    const video = document.getElementById('stream');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const streamURL = 'https://resi.media/JfQsxk/Manifest.m3u8';

    // Android/iOS detection
    const isAndroid = /android/i.test(navigator.userAgent);
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    if (isAndroid) {
      document.body.classList.add('hide-native-fullscreen');
      fullscreenBtn.style.display = 'block';
    } else if (!isIOS) {
      fullscreenBtn.style.display = 'block';
    }

    function updateCountdown() {
      const now = new Date();
      if (now >= revealTime) {
        // Show stream, hide countdown
        countdownDiv.style.display = 'none';
        video.style.display = 'block';
        showStream();
        clearInterval(timerInterval);
      } else {
        // Show countdown
        let diff = streamStartTime - now;
        if (diff < 0) diff = 0;
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((diff % (1000 * 60)) / 1000);
        timerDiv.textContent = 
          (hours > 0 ? hours + "h " : "") +
          (mins > 0 ? mins + "m " : "") +
          secs + "s";
      }
    }

    function showStream() {
      // Initialize HLS.js or native playback
      if (Hls.isSupported()) {
        const hls = new Hls({ liveSyncDuration: 3 });
        hls.loadSource(streamURL);
        hls.attachMedia(video);
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = streamURL;
      } else {
        video.outerHTML = '<p style="color: white; text-align: center;">This device does not support live streaming.</p>';
      }
    }

    // Custom Fullscreen handler
    fullscreenBtn.addEventListener('click', function() {
      if (video.requestFullscreen) {
        video.requestFullscreen();
      } else if (video.mozRequestFullScreen) {
        video.mozRequestFullScreen();
      } else if (video.webkitRequestFullscreen) {
        video.webkitRequestFullscreen();
      } else if (video.msRequestFullscreen) {
        video.msRequestFullscreen();
      }
    });

    // Start countdown timer
    updateCountdown();
    const timerInterval = setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
